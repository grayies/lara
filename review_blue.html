<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="codegrid" />
    <title>Lara perfumes</title>
    <!-- Firebase App (core) + Firestore -->
    <!-- <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script> -->
    <!-- Google Fonts for Material Symbols -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    <style>
      :root {
        --special-color: #7f4c21;
      }
      .second-screen {
        display: block !important;
      }
      .page-bestseller {
        display: block;
      }
      .content {
        overflow-x: hidden !important;
        min-height: calc(100vh - 100px) !important;
        height: auto !important;
        padding: 0 0 60px !important;
        top: -100px;
      }
      .container {
        background: #fff8f3 !important;
      }
      .material-symbols-outlined {
        font-variation-settings:
          "FILL" 0,
          "wght" 400,
          "GRAD" 0,
          "opsz" 24;
      }
      .nav {
        top: 0 !important;
      }

      .container-product {
        background: #fff8f3 !important;
      }
      .speacial-text-container {
        top: 100px;
      }
      .star-rating-input {
        direction: rtl; /* important trick */
        display: inline-block;
      }

      .star-rating-input label {
        color: #444;
        transition: color 0.2s;
        cursor: pointer;
      }

      .star-rating-input input[type="radio"]:checked ~ label,
      .star-rating-input label:hover,
      .star-rating-input label:hover ~ label {
        color: #f5c518; /* gold / yellow */
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/CustomEase.min.js"></script>
    <link rel="stylesheet" href="static/css/master.css" />
    <link rel="stylesheet" href="static/css/product.css" />
    <script src="https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.20/bundled/lenis.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/ScrollTrigger.min.js"></script>
    <!-- <script src="main.js"></script> -->
  </head>
  <body>
    <div class="section-indicator">
      <span class="section-text">hero-01</span>
    </div>
    <nav class="nav">
      <!-- menu -->

      <!-- <div class="menu-toggle closed">
        <div class="menu-toggle-icon">
          <div class="hamburger">
            <div class="menu-bar" data-position="top"></div>
            <div class="menu-bar" data-position="bottom"></div>
          </div>
        </div>
        <div class="menu-copy"><p>Menu</p></div>
      </div> -->

      <!-- <div class="menu-toggle closed">
        <div class="menu-toggle-icon">
          <div class="hamburger">
            <div class="menu-bar" data-position="top"></div>
            <div class="menu-bar" data-position="bottom"></div>
          </div>
        </div>
        <div class="menu-copy"><p>Menu</p></div>
      </div> -->

      <div class="menu">
        <div class="col col-1">
          <!-- <div class="menu-logo"><a href="#">LARA</a></div> -->
          <div class="links">
            <div class="link">
              <a href="perfumes.html">Perfumes</a>
            </div>
            <div class="link">
              <a href="samples.html">samples</a>
            </div>
            <div class="link">
              <a href="collections.html">collections</a>
            </div>
            <div class="link"><a href="story.html">story</a></div>
          </div>
          <div class="video-wrapper">
            <video autoplay muted loop>
              <!-- <source src="static/img/thevideo.mp4" type="video/mp4" /> -->
            </video>
          </div>
        </div>

        <div class="col col-2">
          <div class="socials">
            <div class="sub-col">
              <p>none</p>
              <p>9 quo Androe Rockfield</p>
              <p>69801 Ontario</p>
              <p>Canada</p>
              <br />
              <p>mohamadallosh@hotmail.com</p>
              <p></p>
            </div>
            <div class="sub-col">
              <p>Instagram</p>
              <p>LinkedIn</p>
              <p>Twitter</p>
              <p>Facebook</p>
              <br />
              <p>01 02 030 04 05</p>
            </div>
          </div>

          <div class="header">
            <h1>LARA</h1>
          </div>
        </div>
      </div>
      <!-- menu -->
      <ul class="items-left">
        <li class="menu-button">
          <div class="menu-toggle closed">
            <div class="menu-toggle-icon">
              <div class="hamburger">
                <div class="menu-bar" data-position="top"></div>
                <div class="menu-bar" data-position="bottom"></div>
              </div>
            </div>
            <div class="menu-copy"><p>Menu</p></div>
          </div>
        </li>
        <li class="show-item">
          <a href="perfumes.html">
            <div class="navigation-item">
              <div class="shape"></div>
              <span class="text">Perfumes</span>
            </div>
          </a>
        </li>
        <li class="show-item">
          <a href="samples.html">
            <div class="navigation-item">
              <div class="shape"></div>
              <span class="text">samples</span>
            </div>
          </a>
        </li>
        <li class="show-item">
          <a href="collections.html">
            <div class="navigation-item">
              <div class="shape"></div>
              <span class="text">collections</span>
            </div>
          </a>
        </li>
        <li class="show-item">
          <a href="story.html">
            <div class="navigation-item">
              <div class="shape"></div>
              <span class="text">story</span>
            </div>
          </a>
        </li>
      </ul>
      <ul></ul>
      <ul class="items-right">
        <li>
          <a href="https://lara-perfumes-2.myshopify.com/account/register">
            <div class="navigation-item">
              <div class="shape"></div>
              <span class="text">profile</span>
            </div>
          </a>
        </li>
        <li>
          <a href="#cart">
            <div class="navigation-item">
              <div class="shape"></div>
              <span class="text">cart</span>
            </div>
          </a>
        </li>
      </ul>
    </nav>

    <div class="logo-container">
      <div class="logo">
        <a href="index.html" class="logo-link">
          <h1 class="logo-text">LARA</h1>
        </a>
      </div>
    </div>

    <div class="container">
      <div class="content">
        <!-- collection section -->
        <div class="speacial-text-container">
          <h2 class="special-heading">review</h2>
          <p>leave a review</p>
        </div>
        <div
          style="
            text-align: center;
            margin-bottom: 2rem;
            top: 100px;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
          "
        >
          <img
            src="static/img/blue-wave.jpeg"
            alt="Product Image"
            style="
              max-width: 300px;
              width: 100%;
              border-radius: 12px;
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            "
          />
        </div>
        <!-- Write Review Form -->
        <div
          class="write-review"
          style="
            max-width: 900px;
            width: auto;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            left: 50%;
            position: relative;
            transform: translate(-50%, 100px);
          "
        >
          <h4 style="margin-bottom: 1.2rem; font-size: 1.25rem">
            Write a Review
          </h4>

          <form id="reviewForm">
            <!-- Star Rating -->
            <div class="form-group" style="margin-bottom: 1.2rem">
              <label
                style="display: block; margin-bottom: 0.5rem; font-weight: 600"
                >Rating</label
              >
              <div
                class="star-rating-input"
                style="
                  font-size: 2rem;
                  color: #888;
                  cursor: pointer;
                  user-select: none;
                "
              >
                <input
                  type="radio"
                  id="star5"
                  name="rating"
                  value="5"
                  style="display: none"
                  required
                />
                <label for="star5" title="5 stars">★</label>
                <input
                  type="radio"
                  id="star4"
                  name="rating"
                  value="4"
                  style="display: none"
                />
                <label for="star4" title="4 stars">★</label>
                <input
                  type="radio"
                  id="star3"
                  name="rating"
                  value="3"
                  style="display: none"
                />
                <label for="star3" title="3 stars">★</label>
                <input
                  type="radio"
                  id="star2"
                  name="rating"
                  value="2"
                  style="display: none"
                />
                <label for="star2" title="2 stars">★</label>
                <input
                  type="radio"
                  id="star1"
                  name="rating"
                  value="1"
                  style="display: none"
                />
                <label for="star1" title="1 star">★</label>
              </div>
            </div>

            <!-- Title -->
            <div class="form-group" style="margin-bottom: 1.2rem">
              <label
                for="reviewTitle"
                style="display: block; margin-bottom: 0.5rem; font-weight: 600"
                >Title</label
              >
              <input
                type="text"
                id="reviewTitle"
                name="title"
                required
                placeholder="e.g. My new favorite scent!"
                style="
                  width: 100%;
                  padding: 0.8rem;
                  border-radius: 6px;
                  border: 1px solid #444;
                  background: #222;
                  color: #fff;
                "
              />
            </div>

            <!-- Comment -->
            <div class="form-group" style="margin-bottom: 1.2rem">
              <label
                for="reviewComment"
                style="display: block; margin-bottom: 0.5rem; font-weight: 600"
                >Your Review</label
              >
              <textarea
                id="reviewComment"
                name="comment"
                rows="5"
                required
                placeholder="What did you like? Any tips?"
                style="
                  width: 100%;
                  padding: 0.8rem;
                  border-radius: 6px;
                  border: 1px solid #444;
                  background: #222;
                  color: #fff;
                  resize: vertical;
                "
              ></textarea>
            </div>

            <!-- Name (optional – can be auto-filled from auth later) -->
            <div class="form-group" style="margin-bottom: 1.5rem">
              <label
                for="reviewName"
                style="display: block; margin-bottom: 0.5rem; font-weight: 600"
                >Name (optional)</label
              >
              <input
                type="text"
                id="reviewName"
                name="name"
                placeholder="Jane D."
                style="
                  width: 100%;
                  padding: 0.8rem;
                  border-radius: 6px;
                  border: 1px solid #444;
                  background: #222;
                  color: #fff;
                "
              />
            </div>

            <button
              type="submit"
              id="submitReviewBtn"
              style="
                background: var(--special-color);
                color: white;
                padding: 0.9rem 1.8rem;
                border: none;
                border-radius: 999px;
                font-weight: 600;
                cursor: pointer;
              "
            >
              Submit Review
            </button>

            <p id="formMessage" style="margin-top: 1rem; min-height: 1.4em"></p>
          </form>
        </div>

        <footer class="footer">
          <div class="container-about">
            <!-- Header Section -->
            <div class="speacial-text-container">
              <h2 class="special-heading about">Connect With Us</h2>
              <p>Stay in touch and explore more</p>
            </div>

            <!-- Footer Content -->
            <div class="footer-content">
              <!-- Quick Links -->
              <div class="footer-section quick-links">
                <h3>Quick Links</h3>
                <ul>
                  <li>
                    <a href="#home" class="navigation-item">
                      <span class="shape"></span>
                      <span class="text">Home</span>
                    </a>
                  </li>
                  <li>
                    <a href="#products" class="navigation-item">
                      <span class="shape"></span>
                      <span class="text">Products</span>
                    </a>
                  </li>
                  <li>
                    <a href="#about" class="navigation-item">
                      <span class="shape"></span>
                      <span class="text">About</span>
                    </a>
                  </li>
                  <li>
                    <a href="#contact" class="navigation-item">
                      <span class="shape"></span>
                      <span class="text">Contact</span>
                    </a>
                  </li>
                </ul>
              </div>

              <!-- Social Media -->
              <div class="footer-section socials">
                <h3>Follow Us</h3>
                <div class="social-links">
                  <a
                    href="https://twitter.com"
                    target="_blank"
                    class="navigation-item"
                  >
                    <span class="shape"></span>
                    <span class="text">Twitter</span>
                  </a>
                  <a
                    href="https://www.instagram.com/lara.perfum/?utm_source=qr&igsh=eWw1NWE1d2p5NG5r#"
                    target="_blank"
                    class="navigation-item"
                  >
                    <span class="shape"></span>
                    <span class="text">Instagram</span>
                  </a>
                  <a
                    href="https://linkedin.com"
                    target="_blank"
                    class="navigation-item"
                  >
                    <span class="shape"></span>
                    <span class="text">LinkedIn</span>
                  </a>
                </div>
              </div>

              <!-- Contact Info -->
              <div class="footer-section contact-info">
                <h3>Contact</h3>
                <p>
                  Email:
                  <a href="mailto:mohamadallosh@hotmail.com"
                    >mohamadallosh@hotmail.com</a
                  >
                </p>
                <p>Phone: <a href="tel:+1234567890">+1 (234) 567-890</a></p>
                <p>Calgary, Canada | Online Store</p>
              </div>
            </div>

            <!-- Copyright -->
            <div class="footer-bottom">
              <p>&copy; 2025 Your Brand. All rights reserved.</p>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <!-- Side Cart -->
    <div
      id="sideCart"
      class="side-cart"
      style="
        position: fixed;
        top: 0;
        right: 0;
        height: 100%;
        width: 24rem;
        background: #fff;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
        z-index: 1000;
      "
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px;
          border-bottom: 1px solid #ccc;
        "
      >
        <h2 style="font-size: 1.5rem; font-weight: 600">Your Cart</h2>
        <button
          id="closeCart"
          style="
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
          "
        >
          <span class="material-symbols-outlined">x</span>
        </button>
      </div>

      <div id="cartItems" style="flex: 1; overflow-y: auto; padding: 15px">
        <!-- Cart items will be injected here -->
        <p style="color: #777">Your cart is empty.</p>
      </div>

      <div style="padding: 15px; border-top: 1px solid #ccc">
        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
          "
        >
          <span style="font-weight: 600">Subtotal</span>
          <span id="cartSubtotal">$0.00</span>
        </div>
        <button
          style="
            width: 100%;
            background: #d97706;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
          "
        >
          View Cart
        </button>
        <button
          style="
            width: 100%;
            background: #fff;
            color: #333;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
          "
        >
          Checkout
        </button>
      </div>
    </div>

    <!-- Overlay when cart is open -->
    <div
      id="cartOverlay"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 999;
      "
    ></div>

    <!-- ==================== QUICK VIEW MODAL (Pure HTML + CSS) ==================== -->
    <div id="quickViewModal" class="qv-modal">
      <div id="quickViewContent" class="qv-content">
        <!-- LEFT: Product Image -->
        <div class="qv-image-container">
          <img id="modalImage" src="" alt="Perfume" class="qv-image" />
        </div>

        <!-- RIGHT: Product Details -->
        <div class="qv-details">
          <button onclick="closeQuickView()" class="qv-close-btn">
            <span class="material-symbols-outlined">close</span>
          </button>

          <div class="qv-details-inner">
            <!-- Title -->
            <div class="qv-title-section">
              <h3 id="modalTitle" class="qv-title"></h3>
              <p class="qv-subtitle">100 ml</p>
            </div>

            <!-- Stock & Sales -->
            <div class="qv-status">
              <span class="qv-in-stock">
                <span class="material-symbols-outlined">check_circle</span>
                In Stock
              </span>
              <!-- <span class="qv-sold">
                <span class="material-symbols-outlined"
                  >local_fire_department</span
                >
                <span id="modalSold">63143</span> sold
              </span> -->
            </div>

            <!-- Reviews Section -->
            <div class="qv-reviews-section">
              <div class="qv-overall-rating">
                <span class="qv-stars">★★★★★</span>
                <span class="qv-review-count">(14 reviews)</span>
              </div>

              <div class="qv-customer-reviews">
                <div class="qv-review-item">
                  <div class="qv-review-header">
                    <span class="qv-review-name">Lina R.</span>
                    <span class="qv-stars-sm">★★★★★</span>
                  </div>
                  <p class="qv-review-text">
                    Obsessed! Smells expensive and unique. Already bought two
                    bottles.
                  </p>
                </div>
              </div>

              <!-- <button class="qv-view-all-reviews">
                View all 214 reviews
                <span class="material-symbols-outlined">arrow_forward</span>
              </button> -->
            </div>

            <!-- Price -->
            <div class="qv-price">
              <span id="modalDiscountPrice" class="qv-old-price"></span>
              <span id="modalPrice" class="qv-new-price">$50</span>
            </div>

            <!-- Try-on Text -->
            <div class="qv-try-on">
              <p>Try it on your skin and choose the best option for you</p>
            </div>

            <!-- Action Buttons -->
            <div class="qv-actions">
              <button class="qv-add-to-cart">
                <span class="material-symbols-outlined">shopping_bag</span>
                Add to Cart
              </button>
              <button class="qv-buy-now">Buy Now</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Toast Notification (Top-Left) -->
    <div id="authToast" class="auth-toast">
      <span class="material-symbols-outlined">warning</span>
      <span
        >Please
        <a
          href="sign_in.html"
          style="color: #d97706; text-decoration: underline"
          >sign in</a
        >
        to add favorites.</span
      >
    </div>
    <script type="text/javascript">
      /*<![CDATA[*/
      (function () {
        var scriptURL =
          "https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js";
        if (window.ShopifyBuy) {
          if (window.ShopifyBuy.UI) {
            ShopifyBuyInit();
          } else {
            loadScript();
          }
        } else {
          loadScript();
        }
        function loadScript() {
          var script = document.createElement("script");
          script.async = true;
          script.src = scriptURL;
          (
            document.getElementsByTagName("head")[0] ||
            document.getElementsByTagName("body")[0]
          ).appendChild(script);
          script.onload = ShopifyBuyInit;
        }
        function ShopifyBuyInit() {
          var client = ShopifyBuy.buildClient({
            domain: "ydmggt-mr.myshopify.com",
            storefrontAccessToken: "9d3f54a067ce1ef505736f5ad45131fc",
          });
          ShopifyBuy.UI.onReady(client).then(function (ui) {
            ui.createComponent("product", {
              id: "8156918481011",
              node: document.getElementById("product-component-1767968008927"),
              moneyFormat: "%24%7B%7Bamount%7D%7D",
              options: {
                product: {
                  styles: {
                    product: {
                      "@media (min-width: 601px)": {
                        "max-width": "calc(25% - 20px)",
                        "margin-left": "20px",
                        "margin-bottom": "50px",
                      },
                    },
                    button: {
                      "font-family": "Geneva, sans-serif",
                      "font-size": "15px",
                      "font-weight": "600",

                      /* SIZE */
                      "padding-top": "12px",
                      "padding-bottom": "12px",
                      "padding-left": "28px",
                      "padding-right": "28px",
                      "min-height": "46px",
                      "min-width": "220px", // makes it wide like the image

                      /* SHAPE */
                      "border-radius": "999px", // pill shape

                      "background-color": "#8b0000",
                      color: "#fff",
                      "text-decoration": "none",
                      "white-space": "nowrap",
                      overflow: "visible",
                      "text-overflow": "clip",

                      transition: "background 0.2s ease, transform 0.15s ease",

                      ":hover": {
                        "background-color": "#660000",
                      },
                      ":focus": {
                        "background-color": "#660000",
                      },
                    },
                    quantityInput: {
                      "font-size": "13px",
                      "padding-top": "14.5px",
                      "padding-bottom": "14.5px",
                    },
                  },
                  contents: {
                    img: false,
                    title: false,
                    price: false,
                  },
                  text: {
                    button: "Add to cart",
                  },
                },
                productSet: {
                  styles: {
                    products: {
                      "@media (min-width: 601px)": {
                        "margin-left": "-20px",
                      },
                    },
                  },
                },
                modalProduct: {
                  contents: {
                    img: false,
                    imgWithCarousel: true,
                    button: false,
                    buttonWithQuantity: true,
                  },
                  styles: {
                    product: {
                      "@media (min-width: 601px)": {
                        "max-width": "100%",
                        "margin-left": "0px",
                        "margin-bottom": "0px",
                      },
                    },
                    button: {
                      "font-family": "Geneva, sans-serif",
                      "font-size": "15px",
                      "font-weight": "600",

                      /* SIZE */
                      "padding-top": "12px",
                      "padding-bottom": "12px",
                      "padding-left": "28px",
                      "padding-right": "28px",
                      "min-height": "46px",
                      "min-width": "220px", // makes it wide like the image

                      /* SHAPE */
                      "border-radius": "999px", // pill shape

                      "background-color": "#8b0000",
                      color: "#fff",
                      "text-decoration": "none",
                      "white-space": "nowrap",
                      overflow: "visible",
                      "text-overflow": "clip",

                      transition: "background 0.2s ease, transform 0.15s ease",

                      ":hover": {
                        "background-color": "#660000",
                      },
                      ":focus": {
                        "background-color": "#660000",
                      },
                    },
                    quantityInput: {
                      "font-size": "13px",
                      "padding-top": "14.5px",
                      "padding-bottom": "14.5px",
                    },
                  },
                  text: {
                    button: "Add to cart",
                  },
                },
                option: {},
                cart: {
                  styles: {
                    button: {
                      "font-size": "13px",
                      "padding-top": "14.5px",
                      "padding-bottom": "14.5px",
                      ":hover": {
                        "background-color": "#000000",
                      },
                      "background-color": "#000000",
                      ":focus": {
                        "background-color": "#000000",
                      },
                      "border-radius": "40px",
                    },
                  },
                  text: {
                    total: "Subtotal",
                    button: "Checkout",
                  },
                  contents: {
                    note: true,
                  },
                  popup: false,
                },
                toggle: {
                  styles: {
                    toggle: {
                      "background-color": "#000000",
                      ":hover": {
                        "background-color": "#000000",
                      },
                      ":focus": {
                        "background-color": "#000000",
                      },
                    },
                    count: {
                      "font-size": "13px",
                    },
                  },
                },
              },
            });
          });
        }
      })();
      /*]]>*/
    </script>
    <script>
      // Simple thumbnail switching
      const thumbs = document.querySelectorAll(".thumb-btn");
      const mainImg = document.querySelector(".main-image");

      thumbs.forEach((btn) => {
        btn.addEventListener("click", () => {
          thumbs.forEach((t) => t.classList.remove("active"));
          btn.classList.add("active");
          mainImg.src = btn.querySelector("img").src;
        });
      });
    </script>
    <!-- Firebase App (core) + Firestore -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

    <script>
      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyCJ2OWTPNbsHmHxMK5W7HQ0CqWm62Z-YQs",
        authDomain: "lara-76102.firebaseapp.com",
        projectId: "lara-76102",
        storageBucket: "lara-76102.firebasestorage.app",
        messagingSenderId: "628256871308",
        appId: "1:628256871308:web:c7f854921a683a3f72bca9",
        measurementId: "G-XKFL5M40TH",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      const PRODUCT_ID = "roge";

      // ── Load & render reviews ───────────────────────────────────────
      async function loadReviews() {
        try {
          const col = db.collection(`reviews/${PRODUCT_ID}/reviews`);
          const snap = await col.orderBy("createdAt", "desc").get();

          if (snap.empty) {
            document.getElementById("reviews-list").innerHTML =
              `<p style="text-align:center;padding:3rem 0;color:#888">No reviews yet. Be the first!</p>`;
            document.getElementById("review-count-text").textContent =
              "0 reviews";
            return;
          }

          let total = 0,
            c = [0, 0, 0, 0, 0, 0]; // index 1..5
          const reviews = [];

          snap.forEach((doc) => {
            const d = doc.data();
            const r = Number(d.rating) || 0;
            total += r;
            if (r >= 1 && r <= 5) c[Math.floor(r)]++;
            reviews.push(d);
          });

          const count = snap.size;
          const avg = count ? (total / count).toFixed(1) : "0.0";

          // Average & stars
          document.getElementById("avg-rating").textContent = avg;
          const starsContainer = document.getElementById("avg-stars");
          starsContainer.innerHTML = "";
          const full = Math.floor(Number(avg));
          const half = Number(avg) % 1 >= 0.5;
          for (let i = 0; i < full; i++) {
            starsContainer.innerHTML += `<span class="material-symbols-outlined filled" style="font-size:20px">star</span>`;
          }
          if (half) {
            starsContainer.innerHTML += `<span class="material-symbols-outlined filled" style="font-size:20px">star_half</span>`;
          }
          for (let i = full + (half ? 1 : 0); i < 5; i++) {
            starsContainer.innerHTML += `<span class="material-symbols-outlined" style="font-size:20px;color:#555">star</span>`;
          }

          document.getElementById("review-count-text").textContent =
            `${avg} (${count} reviews)`;

          // Bars
          const bars = document.getElementById("rating-bars");
          bars.innerHTML = "";
          for (let i = 5; i >= 1; i--) {
            const pct = count ? Math.round((c[i] / count) * 100) : 0;
            bars.innerHTML += `
              <div style="display:flex;align-items:center;gap:16px;font-size:14px;">
                <span style="width:12px;font-weight:bold;color:#aaa">${i}</span>
                <div style="flex:1;height:10px;background:#333;border-radius:5px;overflow:hidden;">
                  <div style="height:100%;width:${pct}%;background:var(--special-color);transition:width 0.5s;"></div>
                </div>
                <span style="width:36px;text-align:right;color:#f9a8d4">${pct}%</span>
              </div>`;
          }

          // Review cards
          const list = document.getElementById("reviews-list");
          list.innerHTML = "";
          reviews.slice(0, 10).forEach((r) => {
            const date = r.createdAt
              ? new Date(r.createdAt.toDate()).toLocaleDateString("en-US", {
                  month: "short",
                  day: "numeric",
                })
              : "—";
            const stars =
              "★".repeat(Math.floor(r.rating || 0)) +
              (r.rating % 1 >= 0.5 ? "½" : "") +
              "☆".repeat(5 - Math.ceil(r.rating || 0));
            list.innerHTML += `
              <div class="review-card" style="padding:1.2rem;background:rgba(255,255,255,0.05);border-radius:8px;">
                <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:0.8rem;">
                  <div style="display:flex;align-items:center;gap:12px;">
                    <div style="width:40px;height:40px;border-radius:50%;background:var(--special-color);color:white;display:flex;align-items:center;justify-content:center;font-weight:bold;">
                      ${(r.authorName || "?")[0].toUpperCase()}
                    </div>
                    <div>
                      <div style="font-weight:600;">${
                        r.authorName || "Anonymous"
                      }</div>
                      ${
                        r.verified
                          ? '<small style="color:#4ade80">Verified Buyer</small>'
                          : ""
                      }
                    </div>
                  </div>
                  <small style="color:#888">${date}</small>
                </div>
                <div style="color:#f5c518;margin-bottom:0.6rem;">${stars}</div>
                <div style="font-weight:600;margin-bottom:0.4rem">${
                  r.title || ""
                }</div>
                <p style="color:#ddd;line-height:1.5">${r.comment || ""}</p>
              </div>`;
          });
        } catch (err) {
          console.error("Reviews error:", err);
          document.getElementById("reviews-list").innerHTML =
            `<p style="color:#f87171;text-align:center;padding:3rem 0">Could not load reviews</p>`;
        }
      }

      // Real-time listener
      let unsubscribe = null;
      function listenToReviews() {
        if (unsubscribe) unsubscribe();
        unsubscribe = db
          .collection(`reviews/${PRODUCT_ID}/reviews`)
          .orderBy("createdAt", "desc")
          .onSnapshot(() => loadReviews());
      }

      // Submit new review
      document
        .getElementById("reviewForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const btn = document.getElementById("submitReviewBtn");
          const msg = document.getElementById("formMessage");
          btn.disabled = true;
          msg.textContent = "Submitting...";

          try {
            const rating = document.querySelector(
              'input[name="rating"]:checked',
            )?.value;
            if (!rating) throw new Error("Please select stars");

            const title = document.getElementById("reviewTitle").value.trim();
            const comment = document
              .getElementById("reviewComment")
              .value.trim();
            const name =
              document.getElementById("reviewName").value.trim() || "Anonymous";

            if (comment.length < 10) throw new Error("Review too short");

            await db.collection(`reviews/${PRODUCT_ID}/reviews`).add({
              rating: Number(rating),
              title,
              comment,
              authorName: name,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              verified: false,
            });

            msg.style.color = "lime";
            msg.textContent = "Review submitted!";
            e.target.reset();
          } catch (err) {
            msg.style.color = "tomato";
            msg.textContent = err.message || "Failed to submit";
            console.error(err);
          } finally {
            btn.disabled = false;
          }
        });

      // Start
      document.addEventListener("DOMContentLoaded", () => {
        loadReviews();
        listenToReviews();
      });
    </script>
    <script src="static/js/shopify_products.js"></script>
    <script src="static/js/main.js"></script>
  </body>
</html>
